CHƯƠNG 4: CÀI ĐẶT VÀ TRIỂN KHAI
Chương này trình bày chi tiết quá trình cài đặt và triển khai hệ thống quản lý nghiên cứu khoa học dựa trên thiết kế đã nêu ở chương trước. Mỗi phần đều giải thích lý do chọn công nghệ và cách thức triển khai cụ thể.
4.1. CẤU TRÚC DỰ ÁN
4.1.1. Tổ chức Monorepo với Nx
Dự án được tổ chức theo mô hình Monorepo sử dụng Nx phiên bản 22.3.3. Monorepo cho phép quản lý nhiều ứng dụng và thư viện trong cùng một repository Git.
Cấu trúc thư mục chính bao gồm apps/src chứa mã nguồn backend NestJS, web-apps/src chứa mã nguồn frontend React, web-apps-e2e chứa test end-to-end với Playwright, và prisma chứa schema và migration cơ sở dữ liệu.
Lý do dùng Nx là quản lý dependencies giữa các phần của dự án một cách thông minh. Khi thay đổi một thư viện dùng chung, Nx tự động biết phải build lại những phần nào. Điều này giúp tiết kiệm thời gian build đáng kể.
Lý do dùng Monorepo thay vì nhiều repository riêng là chia sẻ code và types giữa frontend và backend dễ dàng. Khi thay đổi API response, TypeScript types được cập nhật ở một nơi và cả hai phía đều dùng chung.
Nếu dùng nhiều repository, việc đồng bộ types giữa frontend và backend rất khó khăn và dễ xảy ra lỗi không khớp kiểu dữ liệu.
4.1.2. Cấu trúc Backend NestJS
Backend được xây dựng với NestJS phiên bản 11.0.0 và TypeScript 5.9.2. Mã nguồn được tổ chức thành 23 module độc lập trong thư mục apps/src/modules.
Nhóm module xác thực và bảo mật gồm auth xử lý đăng nhập với JWT và Passport, rbac quản lý 8 vai trò và 8 nhóm quyền, và users quản lý thông tin người dùng.
Nhóm module nghiệp vụ chính gồm proposals quản lý đề tài với 13 trạng thái, workflow xử lý máy trạng thái với 26 loại hành động, council quản lý 3 loại Hội đồng, và evaluations xử lý phiếu đánh giá.
Nhóm module tài liệu gồm documents quản lý tài liệu đã tạo, document-templates quản lý 6 loại mẫu Word, proposal-documents quản lý 18 loại biểu mẫu từ FORM_1B đến FORM_18B, và attachments quản lý file đính kèm.
Nhóm module hỗ trợ gồm faculties quản lý đơn vị, calendar quản lý lịch làm việc, audit ghi log kiểm toán, dashboard thống kê, notifications gửi email, exports xuất Excel và PDF, imports nhập dữ liệu, bulk-operations xử lý hàng loạt, holidays quản lý ngày nghỉ, backup sao lưu dữ liệu, và form-engine tích hợp với microservice Python.
Mỗi module có cấu trúc chuẩn gồm file module.ts khai báo dependencies, file controller.ts xử lý HTTP request, file service.ts chứa logic nghiệp vụ, và thư mục dto chứa các class định nghĩa dữ liệu đầu vào đầu ra.
4.1.3. Cấu trúc Frontend React
Frontend được xây dựng với React phiên bản 19.0.0, Vite 7.0.0 làm build tool, và TypeScript. Mã nguồn trong web-apps/src được tổ chức theo tính năng.
Thư mục app chứa các trang ứng dụng bao gồm admin quản trị hệ thống, auth đăng nhập, proposals quản lý đề tài, dashboard thống kê, councils quản lý Hội đồng, form-templates cấu hình biểu mẫu, calendar quản lý lịch, bulk-operations xử lý hàng loạt, và audit xem log kiểm toán.
Thư mục components chứa các thành phần giao diện tái sử dụng bao gồm ui cho các component cơ bản như button và input, layout cho header và sidebar, forms cho form builder, proposals cho component liên quan đề tài, workflow cho hiển thị trạng thái, evaluation cho phiếu đánh giá, document-generation cho tạo tài liệu, councils cho thành viên Hội đồng, và charts cho biểu đồ.
Thư mục lib chứa các tiện ích bao gồm api cho client gọi API dựa trên Axios, auth cho hooks xác thực, rbac cho kiểm tra quyền, constants cho hằng số, và utils cho hàm tiện ích.
Thư mục stores chứa Zustand store quản lý trạng thái toàn cục và thư mục hooks chứa các custom hooks.
4.1.4. Cấu trúc Form Engine Python
Form Engine là microservice Python chạy độc lập trong thư mục form-engine-service. Sử dụng FastAPI phiên bản 0.109.2 với Uvicorn làm ASGI server.
Cấu trúc thư mục gồm app chứa mã nguồn FastAPI, templates chứa 18 mẫu biểu mẫu Word từ FORM_1B đến FORM_18B, output chứa file đã tạo, và logs chứa log hoạt động.
Dependencies chính bao gồm python-docx phiên bản 1.1.0 để xử lý file Word, pydantic 2.7.0 để validate dữ liệu, python-multipart 0.0.9 để nhận file upload, httpx 0.27.0 làm HTTP client, và aiofiles 23.2.1 để đọc ghi file bất đồng bộ.
LibreOffice được cài đặt trong Docker image để chuyển đổi Word sang PDF ở chế độ headless không cần giao diện.
