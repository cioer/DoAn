graph TB
    %% Kiáº¿n trÃºc Hybrid - Há»‡ thá»‘ng qlNCKH
    %% Main Application (Modular Monolith) + Form Engine Microservice

    subgraph Client["ğŸ‘¤ CLIENT LAYER"]
        Browser["ğŸŒ Web Browser<br/>(Chrome, Firefox, Edge)"]
    end

    subgraph Frontend["âš›ï¸ FRONTEND APPLICATION - React 18"]
        ReactApp["React 18 + TypeScript<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Vite 7 (Build Tool)<br/>â€¢ TanStack Query (Data Fetching)<br/>â€¢ React Router 6 (Routing)<br/>â€¢ Tailwind CSS 4 (Styling)<br/>â€¢ Zustand (State Management)"]
    end

    subgraph MainBackend["ğŸ¢ MAIN APPLICATION - NestJS (Modular Monolith)"]
        direction TB
        NestJS["NestJS 11 + TypeScript<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>23 Modules:"]

        subgraph CoreModules["Core Modules"]
            Auth["ğŸ” Auth<br/>(JWT + Refresh Token)"]
            Users["ğŸ‘¥ Users"]
            RBAC["ğŸ›¡ï¸ RBAC<br/>(3D Authorization)"]
            Audit["ğŸ“‹ Audit<br/>(Event Sourcing)"]
        end

        subgraph BusinessModules["Business Modules"]
            Proposals["ğŸ“„ Proposals"]
            Workflow["âš™ï¸ Workflow<br/>(State Machine)"]
            Calendar["ğŸ“… Calendar<br/>(Working Hours SLA)"]
            Council["ğŸ‘¨â€âš–ï¸ Council"]
            Evaluation["ğŸ“Š Evaluation"]
        end

        subgraph DocumentModules["Document Modules"]
            FormTemplates["ğŸ“ Form Templates"]
            Documents["ğŸ“‘ Documents"]
            DocTemplates["ğŸ“‹ Document Templates"]
            ProposalDocs["ğŸ“„ Proposal Documents"]
            FormEngineIntegration["ğŸ”— Form Engine Integration"]
            PDF["ğŸ“• PDF Export"]
            Attachments["ğŸ“ Attachments"]
        end

        subgraph UtilityModules["Utility Modules"]
            BulkOps["âš¡ Bulk Operations"]
            Notifications["ğŸ”” Notifications"]
            Exports["ğŸ“¤ Excel Export"]
            Import["ğŸ“¥ Excel Import"]
            Dashboard["ğŸ“Š Dashboard"]
            Backup["ğŸ’¾ Backup & Restore"]
            Holidays["ğŸ–ï¸ Holidays"]
            Faculties["ğŸ›ï¸ Faculties"]
        end
    end

    subgraph FormEngine["ğŸ FORM ENGINE MICROSERVICE - Python"]
        FastAPI["FastAPI 0.109<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Document Generation Service"]
        PythonDocx["python-docx 1.1<br/>(DOCX Generation)"]
        LibreOffice["LibreOffice 7<br/>(Headless PDF Conversion)"]
        Templates["18 Form Templates<br/>(1b - 18b)"]

        FastAPI --> PythonDocx
        FastAPI --> LibreOffice
        FastAPI --> Templates
    end

    subgraph DataLayer["ğŸ’¾ DATA LAYER"]
        PostgreSQL["ğŸ˜ PostgreSQL 15<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ 21 Tables<br/>â€¢ 85+ Indexes<br/>â€¢ ACID Compliant<br/>â€¢ Prisma ORM"]
        Redis["ğŸ”´ Redis 7<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ JWT Blacklist<br/>â€¢ Session Cache<br/>â€¢ Rate Limiting"]
    end

    %% Connections - Client to Frontend
    Browser -->|"HTTPS<br/>Port 5173 (Dev)<br/>Port 443 (Prod)"| ReactApp

    %% Connections - Frontend to Backend
    ReactApp -->|"REST API<br/>67 Endpoints<br/>JWT Authentication"| NestJS

    %% Connections - Backend Internal
    NestJS --> CoreModules
    NestJS --> BusinessModules
    NestJS --> DocumentModules
    NestJS --> UtilityModules

    %% Connections - Backend to Data Layer
    NestJS -->|"Prisma ORM<br/>Connection Pool"| PostgreSQL
    NestJS -->|"Redis Client<br/>Caching Layer"| Redis

    %% Connections - Backend to Form Engine Microservice
    FormEngineIntegration -->|"HTTP REST API<br/>POST /generate-docx<br/>POST /convert-to-pdf"| FastAPI

    %% Styling
    classDef clientStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef frontendStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:3px,color:#000
    classDef backendStyle fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#000
    classDef microserviceStyle fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000
    classDef dataStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000
    classDef moduleStyle fill:#ffffff,stroke:#616161,stroke-width:2px,color:#000

    class Browser clientStyle
    class ReactApp frontendStyle
    class NestJS,CoreModules,BusinessModules,DocumentModules,UtilityModules backendStyle
    class Auth,Users,RBAC,Audit,Proposals,Workflow,Calendar,Council,Evaluation moduleStyle
    class FormTemplates,Documents,DocTemplates,ProposalDocs,FormEngineIntegration,PDF,Attachments moduleStyle
    class BulkOps,Notifications,Exports,Import,Dashboard,Backup,Holidays,Faculties moduleStyle
    class FastAPI,PythonDocx,LibreOffice,Templates microserviceStyle
    class PostgreSQL,Redis dataStyle
