graph TD
    %% 3D RBAC - Role-Based Access Control
    %% Dimensions: Role √ó State √ó Action

    subgraph RBAC["üõ°Ô∏è 3D RBAC AUTHORIZATION SYSTEM"]
        direction TB

        subgraph Dimension1["üìä DIMENSION 1: ROLES (9 Roles)"]
            R1["üë®‚Äçüè´ GIANG_VIEN<br/>(Gi·∫£ng vi√™n / PI)"]
            R2["üëî QUAN_LY_KHOA<br/>(Qu·∫£n l√Ω Khoa)"]
            R3["üìã THU_KY_KHOA<br/>(Th∆∞ k√Ω Khoa)"]
            R4["üè¢ PHONG_KHCN<br/>(Ph√≤ng KHCN)"]
            R5["üìù THU_KY_HOI_DONG<br/>(Th∆∞ k√Ω Hƒê)"]
            R6["üë®‚Äç‚öñÔ∏è THANH_TRUNG<br/>(Th√†nh vi√™n Hƒê)"]
            R7["üéì BAN_GIAM_HOC<br/>(Ban Gi√°m hi·ªáu)"]
            R8["üë§ HOI_DONG<br/>(Legacy)"]
            R9["‚öôÔ∏è ADMIN<br/>(Qu·∫£n tr·ªã h·ªá th·ªëng)"]
        end

        subgraph Dimension2["üîÑ DIMENSION 2: STATES (15 States)"]
            S1["DRAFT"]
            S2["FACULTY_REVIEW"]
            S3["SCHOOL_SELECTION_REVIEW"]
            S4["OUTLINE_COUNCIL_REVIEW"]
            S5["CHANGES_REQUESTED"]
            S6["APPROVED"]
            S7["IN_PROGRESS"]
            S8["FACULTY_ACCEPTANCE_REVIEW"]
            S9["SCHOOL_ACCEPTANCE_REVIEW"]
            S10["HANDOVER"]
            S11["COMPLETED"]
            S12["PAUSED"]
            S13["CANCELLED"]
            S14["REJECTED"]
            S15["WITHDRAWN"]
        end

        subgraph Dimension3["‚ö° DIMENSION 3: ACTIONS (48 Permissions)"]
            direction LR

            subgraph CoreActions["Core Permissions"]
                A1["PROPOSAL_CREATE"]
                A2["PROPOSAL_EDIT"]
                A3["PROPOSAL_VIEW_FACULTY"]
            end

            subgraph WorkflowActions["Workflow Actions"]
                A4["FACULTY_APPROVE"]
                A5["FACULTY_RETURN"]
                A6["SUBMIT"]
                A7["WITHDRAW"]
                A8["CANCEL"]
                A9["PAUSE"]
                A10["RESUME"]
            end

            subgraph ManagementActions["Management"]
                A11["USER_MANAGE"]
                A12["FACULTY_USER_MANAGE"]
                A13["CALENDAR_MANAGE"]
                A14["AUDIT_VIEW"]
            end

            subgraph DocumentActions["Document Actions"]
                A15["EXPORT_PROPOSAL_PDF"]
                A16["VIEW_EVALUATION_RESULTS"]
                A17["FORM_TEMPLATE_IMPORT"]
            end

            subgraph DashboardActions["Dashboard"]
                A18["DASHBOARD_VIEW"]
                A19["FACULTY_DASHBOARD_VIEW"]
            end

            subgraph DemoActions["Demo Features"]
                A20["DEMO_SWITCH_PERSONA"]
                A21["DEMO_RESET"]
            end
        end

        %% Example Authorization Rules (Role √ó State ‚Üí Allowed Actions)

        subgraph AuthMatrix["üìã AUTHORIZATION MATRIX EXAMPLES"]
            direction TB

            Example1["GIANG_VIEN + DRAFT<br/>‚Üí Can: CREATE, EDIT, SUBMIT, CANCEL"]
            Example2["QUAN_LY_KHOA + FACULTY_REVIEW<br/>‚Üí Can: APPROVE, RETURN, REJECT"]
            Example3["PHONG_KHCN + ANY_STATE<br/>‚Üí Can: PAUSE, RESUME, VIEW_ALL"]
            Example4["THU_KY_HOI_DONG + OUTLINE_COUNCIL_REVIEW<br/>‚Üí Can: APPROVE, RETURN"]
            Example5["ADMIN + ANY_STATE<br/>‚Üí Can: ALL_ACTIONS"]
        end
    end

    %% Guard Implementation Flow
    subgraph GuardFlow["üîê GUARD IMPLEMENTATION FLOW"]
        direction LR
        Request["HTTP Request"]
        JWTAuth["JWT Authentication"]
        ExtractContext["Extract Context:<br/>‚Ä¢ User Role<br/>‚Ä¢ Proposal State<br/>‚Ä¢ Requested Action"]
        CheckAuth["3D Authorization Check:<br/>IF (role, state, action)<br/>IN allowed_combinations<br/>THEN permit<br/>ELSE deny"]
        Permit["‚úÖ Permit Access"]
        Deny["‚ùå HTTP 403 Forbidden"]

        Request --> JWTAuth
        JWTAuth --> ExtractContext
        ExtractContext --> CheckAuth
        CheckAuth -->|Authorized| Permit
        CheckAuth -->|Unauthorized| Deny
    end

    %% Styling
    classDef roleStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef stateStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef actionStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef exampleStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef guardStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class R1,R2,R3,R4,R5,R6,R7,R8,R9 roleStyle
    class S1,S2,S3,S4,S5,S6,S7,S8,S9,S10,S11,S12,S13,S14,S15 stateStyle
    class A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21 actionStyle
    class Example1,Example2,Example3,Example4,Example5 exampleStyle
    class Request,JWTAuth,ExtractContext,CheckAuth,Permit,Deny guardStyle
