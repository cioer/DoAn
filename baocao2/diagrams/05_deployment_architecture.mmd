graph TB
    %% Deployment Architecture - Docker Containers
    %% Production deployment vá»›i 5 containers

    subgraph Internet["ğŸŒ INTERNET"]
        Users["ğŸ‘¥ End Users<br/>(Browsers)"]
    end

    subgraph DockerHost["ğŸ³ DOCKER HOST SERVER"]
        direction TB

        subgraph Network["ğŸ”— Docker Network: qlnckh-network"]
            direction TB

            Nginx["ğŸ“¦ NGINX Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Reverse Proxy<br/>â€¢ SSL Termination<br/>â€¢ Load Balancer<br/>â€¢ Static File Serving<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Port: 80, 443<br/>Image: nginx:alpine"]

            Frontend["ğŸ“¦ FRONTEND Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ React 18 SPA<br/>â€¢ Vite Build Output<br/>â€¢ Served by Nginx<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Internal Port: 80<br/>Image: nginx:alpine<br/>Volumes: /app/dist"]

            Backend["ğŸ“¦ BACKEND Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ NestJS Application<br/>â€¢ Node.js 20 Runtime<br/>â€¢ 23 Modules<br/>â€¢ Prisma Client<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Port: 4000<br/>Image: node:20-alpine<br/>CMD: node main.js"]

            FormEngine["ğŸ“¦ FORM ENGINE Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ FastAPI Service<br/>â€¢ Python 3.10<br/>â€¢ python-docx<br/>â€¢ LibreOffice Headless<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Port: 8080<br/>Image: python:3.10-slim<br/>CMD: uvicorn app.main:app"]

            PostgreSQL["ğŸ“¦ POSTGRESQL Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ PostgreSQL 15<br/>â€¢ 21 Tables<br/>â€¢ 85+ Indexes<br/>â€¢ ACID Compliant<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Port: 5432<br/>Image: postgres:15-alpine<br/>Volumes: /var/lib/postgresql/data"]

            Redis["ğŸ“¦ REDIS Container<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Redis 7<br/>â€¢ JWT Blacklist<br/>â€¢ Session Cache<br/>â€¢ Rate Limiting<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Port: 6379<br/>Image: redis:7-alpine<br/>Volumes: /data"]
        end

        subgraph Volumes["ğŸ’¾ DOCKER VOLUMES"]
            Vol1["postgres_data<br/>(Database)"]
            Vol2["redis_data<br/>(Cache)"]
            Vol3["uploads<br/>(File Storage)"]
            Vol4["templates<br/>(Form Templates)"]
        end
    end

    subgraph ExternalServices["â˜ï¸ EXTERNAL SERVICES (Optional)"]
        SMTP["ğŸ“§ SMTP Server<br/>(Email Notifications)"]
        Backup["ğŸ’¾ Backup Storage<br/>(S3-compatible)"]
    end

    %% Network Flow
    Users -->|HTTPS:443| Nginx
    Nginx -->|Proxy /api/*| Backend
    Nginx -->|Serve SPA| Frontend
    Backend -->|HTTP| FormEngine
    Backend -->|SQL| PostgreSQL
    Backend -->|Cache| Redis
    Backend -.->|Optional| SMTP
    Backend -.->|Optional| Backup

    %% Volume Mounts
    PostgreSQL -.->|Mount| Vol1
    Redis -.->|Mount| Vol2
    FormEngine -.->|Mount| Vol3
    FormEngine -.->|Mount| Vol4

    %% Annotations
    subgraph DeploymentNotes["ğŸ“ DEPLOYMENT NOTES"]
        Note1["â€¢ docker-compose.prod.yml orchestrates all 5 containers"]
        Note2["â€¢ Environment variables via .env file"]
        Note3["â€¢ Health checks configured for all services"]
        Note4["â€¢ Automatic restart policy: unless-stopped"]
        Note5["â€¢ Resource limits: CPU 1 core, Memory 512MB per container"]
        Note6["â€¢ Logging: JSON driver with rotation (max-size 10m)"]
    end

    %% Scaling Strategy
    subgraph ScalingStrategy["ğŸ“ˆ SCALING STRATEGY"]
        Horizontal["Horizontal Scaling:<br/>â€¢ Add multiple Backend containers<br/>â€¢ Load balance with Nginx upstream<br/>â€¢ Stateless design (sessions in Redis)"]
        Vertical["Vertical Scaling:<br/>â€¢ Increase container resources<br/>â€¢ Optimize PostgreSQL config<br/>â€¢ Add Redis replicas"]
    end

    %% Health Checks
    subgraph HealthChecks["ğŸ¥ HEALTH CHECKS"]
        HC1["Backend: GET /health â†’ 200 OK"]
        HC2["Form Engine: GET /health â†’ 200 OK"]
        HC3["PostgreSQL: pg_isready"]
        HC4["Redis: redis-cli ping"]
    end

    %% Styling
    classDef containerStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#000
    classDef volumeStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    classDef externalStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#000
    classDef noteStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000

    class Nginx,Frontend,Backend,FormEngine,PostgreSQL,Redis containerStyle
    class Vol1,Vol2,Vol3,Vol4 volumeStyle
    class SMTP,Backup externalStyle
    class Note1,Note2,Note3,Note4,Note5,Note6,Horizontal,Vertical,HC1,HC2,HC3,HC4 noteStyle
